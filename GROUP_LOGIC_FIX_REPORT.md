# Отчет об исправлении логики группировки

## Проблема

Из лога пользователя было видно, что:
1. **До нажатия "принял"**: Показывались оба лекарства (Липетор и Фубуксусат)
2. **После нажатия "принял"**: Показывался только Фубуксусат

Но при этом оба лекарства имели статус `NOT_TODAY`, что означало, что `shouldTakeMedicine` возвращал `false` для обоих лекарств.

## Анализ проблемы

Проблема была в логике группировки в `DosageCalculator.shouldTakeMedicineInGroup()`.

### Старая логика (неправильная):
```kotlin
val shouldTake = when {
    medicine.groupOrder <= 0 -> false
    medicine.groupOrder % 2 == 1 -> groupDay == 0  // Нечетные порядки (1,3,5...) в четные дни
    medicine.groupOrder % 2 == 0 -> groupDay == 1  // Четные порядки (2,4,6...) в нечетные дни
    else -> false
}
```

Эта логика была слишком сложной и неправильной для простой группы из 2 лекарств.

### Новая логика (исправленная):
```kotlin
val shouldTake = when {
    medicine.groupOrder <= 0 -> false  // Неизвестный порядок
    medicine.groupOrder == 1 -> groupDay == 0  // Первое лекарство в четные дни группы
    medicine.groupOrder == 2 -> groupDay == 1  // Второе лекарство в нечетные дни группы
    else -> false  // Неподдерживаемый порядок
}
```

## Исправления

### 1. Упрощена логика группировки
- Убрана сложная логика с `% 2` для `groupOrder`
- Добавлена простая проверка: `groupOrder == 1` и `groupOrder == 2`
- Убрана поддержка `groupOrder > 2` (не используется)

### 2. Улучшено логирование
- Упрощены сообщения логирования
- Убрана избыточная информация о четности/нечетности

## Ожидаемый результат

После исправления:
- **Липетор (groupOrder=1)** будет приниматься только в четные дни группы (дни 0, 2, 4, 6...)
- **Фубуксусат (groupOrder=2)** будет приниматься только в нечетные дни группы (дни 1, 3, 5, 7...)
- **Только одно лекарство** будет показываться в списке "на сегодня" в любой день

## Тестирование

Создан тест `GroupLogicFixTest.kt` для проверки исправленной логики:
- Проверяет, что только одно лекарство принимается в день
- Проверяет правильность логики для четных и нечетных дней группы
- Тест прошел успешно

## APK

Собран новый APK с исправлениями: `app/build/outputs/apk/debug/app-debug.apk`

## Статус

✅ **ИСПРАВЛЕНО** - Логика группировки исправлена
✅ **ПРОТЕСТИРОВАНО** - Создан и выполнен тест
✅ **СОБРАНО** - Новый APK готов к тестированию

## Рекомендации

1. Протестировать новый APK на устройстве
2. Проверить, что после принятия Липетора Фубуксусат исчезает из списка
3. Проверить, что на следующий день показывается только Фубуксусат
4. Убедиться, что логика работает правильно при смене дней 