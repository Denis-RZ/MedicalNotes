# –ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã GroupFixer

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç GroupFixer

### üéØ –û—Å–Ω–æ–≤–Ω–∞—è —Ü–µ–ª—å
`GroupFixer` –∏—Å–ø—Ä–∞–≤–ª—è–µ—Ç **—Ç–æ–ª—å–∫–æ –æ–¥–Ω—É –ø—Ä–æ–±–ª–µ–º—É**: –∫–æ–≥–¥–∞ –ª–µ–∫–∞—Ä—Å—Ç–≤–∞ —Å **–æ–¥–∏–Ω–∞–∫–æ–≤—ã–º –Ω–∞–∑–≤–∞–Ω–∏–µ–º –≥—Ä—É–ø–ø—ã** –∏–º–µ—é—Ç **—Ä–∞–∑–Ω—ã–µ ID –≥—Ä—É–ø–ø**.

### üìã –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã

#### –®–∞–≥ 1: –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é
```kotlin
// –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ª–µ–∫–∞—Ä—Å—Ç–≤–∞ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –≥—Ä—É–ø–ø—ã
val groupsByName = medicines.filter { it.groupName.isNotBlank() }
    .groupBy { it.groupName }
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- –õ–µ–∫–∞—Ä—Å—Ç–≤–∞ –≥—Ä—É–ø–ø–∏—Ä—É—é—Ç—Å—è **—Ç–æ–ª—å–∫–æ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –≥—Ä—É–ø–ø—ã** (`groupName`)
- –õ–µ–∫–∞—Ä—Å—Ç–≤–∞ —Å –ø—É—Å—Ç—ã–º `groupName` –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è
- –ö–∞–∂–¥–æ–µ —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ–π –≥—Ä—É–ø–ø–æ–π

#### –®–∞–≥ 2: –ü–æ–∏—Å–∫ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –≥—Ä—É–ø–ø
```kotlin
// –ù–∞—Ö–æ–¥–∏–º –≥—Ä—É–ø–ø—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å (–æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ, –Ω–æ —Ä–∞–∑–Ω—ã–µ ID)
val groupsToFix = groupsByName.filter { (_, groupMedicines) ->
    val uniqueGroupIds = groupMedicines.map { it.groupId }.distinct()
    uniqueGroupIds.size > 1
}
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- –î–ª—è –∫–∞–∂–¥–æ–π –≥—Ä—É–ø–ø—ã –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è, —Å–∫–æ–ª—å–∫–æ —Ä–∞–∑–Ω—ã—Ö `groupId` —É –ª–µ–∫–∞—Ä—Å—Ç–≤
- –ï—Å–ª–∏ –≤ –≥—Ä—É–ø–ø–µ –±–æ–ª—å—à–µ –æ–¥–Ω–æ–≥–æ `groupId` ‚Üí –≥—Ä—É–ø–ø–∞ –ø—Ä–æ–±–ª–µ–º–Ω–∞—è
- –ï—Å–ª–∏ –≤ –≥—Ä—É–ø–ø–µ —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω `groupId` ‚Üí –≥—Ä—É–ø–ø–∞ –≤ –ø–æ—Ä—è–¥–∫–µ

#### –®–∞–≥ 3: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –≥—Ä—É–ø–ø
```kotlin
groupsToFix.forEach { (groupName, groupMedicines) ->
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–∞–º—É—é —Ä–∞–Ω–Ω—é—é –¥–∞—Ç—É –Ω–∞—á–∞–ª–∞
    val earliestStartDate = groupMedicines.minOf { it.groupStartDate }
    
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–µ—Ä–≤—ã–π ID –≥—Ä—É–ø–ø—ã –∫–∞–∫ –æ–±—â–∏–π
    val commonGroupId = groupMedicines.first().groupId ?: 0L
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞–∂–¥–æ–µ –ª–µ–∫–∞—Ä—Å—Ç–≤–æ
    sortedMedicines.forEachIndexed { index, medicine ->
        val newOrder = index + 1
        // –û–±–Ω–æ–≤–ª—è–µ–º groupId, groupStartDate, groupOrder
    }
}
```

## üö´ –ß—Ç–æ GroupFixer –ù–ï –¥–µ–ª–∞–µ—Ç

### ‚ùå –ù–ï –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –≥—Ä—É–ø–ø—ã —Å —Ä–∞–∑–Ω—ã–º–∏ –Ω–∞–∑–≤–∞–Ω–∏—è–º–∏
**–ü—Ä–∏–º–µ—Ä:**
```
–õ–∏–ø–µ—Ç–æ—Ä: groupName="–¢–µ—Å—Ç–µ—Ä", groupId=1001
–§—É–±—É–∫—Å—É—Å–∞—Ç: groupName="–¢–µ—Å—Ç–µ—Ä", groupId=1002  ‚Üê –ü—Ä–æ–±–ª–µ–º–∞!
–ê—Å–ø–∏—Ä–∏–Ω: groupName="–£—Ç—Ä–µ–Ω–Ω–∏–µ", groupId=2001   ‚Üê –î—Ä—É–≥–∞—è –≥—Ä—É–ø–ø–∞
–í–∏—Ç–∞–º–∏–Ω D: groupName="–£—Ç—Ä–µ–Ω–Ω–∏–µ", groupId=2002 ‚Üê –ü—Ä–æ–±–ª–µ–º–∞!
–û–º–µ–≥–∞-3: groupName="–í–µ—á–µ—Ä–Ω–∏–µ", groupId=3001   ‚Üê –î—Ä—É–≥–∞—è –≥—Ä—É–ø–ø–∞
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- `GroupFixer` –∏—Å–ø—Ä–∞–≤–∏—Ç —Ç–æ–ª—å–∫–æ –≥—Ä—É–ø–ø—ã "–¢–µ—Å—Ç–µ—Ä" –∏ "–£—Ç—Ä–µ–Ω–Ω–∏–µ"
- –ì—Ä—É–ø–ø–∞ "–í–µ—á–µ—Ä–Ω–∏–µ" –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ–π
- –ì—Ä—É–ø–ø—ã "–¢–µ—Å—Ç–µ—Ä" –∏ "–£—Ç—Ä–µ–Ω–Ω–∏–µ" –æ—Å—Ç–∞–Ω—É—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–º–∏ –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞

### ‚ùå –ù–ï –∑–∞—Ç—Ä–∞–≥–∏–≤–∞–µ—Ç –ª–µ–∫–∞—Ä—Å—Ç–≤–∞ –±–µ–∑ –≥—Ä—É–ø–ø—ã
```kotlin
// –õ–µ–∫–∞—Ä—Å—Ç–≤–∞ —Å –ø—É—Å—Ç—ã–º groupName –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è
medicines.filter { it.groupName.isNotBlank() }
```

### ‚ùå –ù–ï –∏–∑–º–µ–Ω—è–µ—Ç –Ω–∞–∑–≤–∞–Ω–∏—è –≥—Ä—É–ø–ø
- `groupName` –æ—Å—Ç–∞–µ—Ç—Å—è –Ω–µ–∏–∑–º–µ–Ω–Ω—ã–º
- –ò–∑–º–µ–Ω—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ `groupId`, `groupStartDate`, `groupOrder`

## ‚úÖ –ß—Ç–æ GroupFixer –¥–µ–ª–∞–µ—Ç

### ‚úÖ –ò—Å–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏ –≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–π –≥—Ä—É–ø–ø—ã
**–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```
–ì—Ä—É–ø–ø–∞ "–¢–µ—Å—Ç–µ—Ä":
- –õ–∏–ø–µ—Ç–æ—Ä: groupId=1001, groupStartDate=1754451744031
- –§—É–±—É–∫—Å—É—Å–∞—Ç: groupId=1002, groupStartDate=1754451755574
```

**–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```
–ì—Ä—É–ø–ø–∞ "–¢–µ—Å—Ç–µ—Ä":
- –õ–∏–ø–µ—Ç–æ—Ä: groupId=1001, groupStartDate=1754451744031
- –§—É–±—É–∫—Å—É—Å–∞—Ç: groupId=1001, groupStartDate=1754451744031
```

### ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –º–µ–∂–¥—É —Ä–∞–∑–Ω—ã–º–∏ –≥—Ä—É–ø–ø–∞–º–∏
**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```
–ì—Ä—É–ø–ø–∞ "–¢–µ—Å—Ç–µ—Ä": ID 1001
  - –õ–∏–ø–µ—Ç–æ—Ä (–ø–æ—Ä—è–¥–æ–∫ 1)
  - –§—É–±—É–∫—Å—É—Å–∞—Ç (–ø–æ—Ä—è–¥–æ–∫ 2)

–ì—Ä—É–ø–ø–∞ "–£—Ç—Ä–µ–Ω–Ω–∏–µ": ID 2001
  - –ê—Å–ø–∏—Ä–∏–Ω (–ø–æ—Ä—è–¥–æ–∫ 1)
  - –í–∏—Ç–∞–º–∏–Ω D (–ø–æ—Ä—è–¥–æ–∫ 2)

–ì—Ä—É–ø–ø–∞ "–í–µ—á–µ—Ä–Ω–∏–µ": ID 3001
  - –û–º–µ–≥–∞-3 (–ø–æ—Ä—è–¥–æ–∫ 1)
```

## üîç –ü—Ä–∏–º–µ—Ä—ã —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –û–¥–Ω–∞ –ø—Ä–æ–±–ª–µ–º–Ω–∞—è –≥—Ä—É–ø–ø–∞
```
–ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:
- –õ–∏–ø–µ—Ç–æ—Ä: "–¢–µ—Å—Ç–µ—Ä", ID=1001
- –§—É–±—É–∫—Å—É—Å–∞—Ç: "–¢–µ—Å—Ç–µ—Ä", ID=1002  ‚Üê –ü—Ä–æ–±–ª–µ–º–∞!

–†–µ–∑—É–ª—å—Ç–∞—Ç:
- –õ–∏–ø–µ—Ç–æ—Ä: "–¢–µ—Å—Ç–µ—Ä", ID=1001
- –§—É–±—É–∫—Å—É—Å–∞—Ç: "–¢–µ—Å—Ç–µ—Ä", ID=1001  ‚Üê –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ!
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –≥—Ä—É–ø–ø—ã
```
–ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:
- –õ–∏–ø–µ—Ç–æ—Ä: "–¢–µ—Å—Ç–µ—Ä", ID=1001
- –§—É–±—É–∫—Å—É—Å–∞—Ç: "–¢–µ—Å—Ç–µ—Ä", ID=1002  ‚Üê –ü—Ä–æ–±–ª–µ–º–∞!
- –ê—Å–ø–∏—Ä–∏–Ω: "–£—Ç—Ä–µ–Ω–Ω–∏–µ", ID=2001
- –í–∏—Ç–∞–º–∏–Ω D: "–£—Ç—Ä–µ–Ω–Ω–∏–µ", ID=2002  ‚Üê –ü—Ä–æ–±–ª–µ–º–∞!

–†–µ–∑—É–ª—å—Ç–∞—Ç:
- –õ–∏–ø–µ—Ç–æ—Ä: "–¢–µ—Å—Ç–µ—Ä", ID=1001
- –§—É–±—É–∫—Å—É—Å–∞—Ç: "–¢–µ—Å—Ç–µ—Ä", ID=1001  ‚Üê –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ!
- –ê—Å–ø–∏—Ä–∏–Ω: "–£—Ç—Ä–µ–Ω–Ω–∏–µ", ID=2001
- –í–∏—Ç–∞–º–∏–Ω D: "–£—Ç—Ä–µ–Ω–Ω–∏–µ", ID=2001  ‚Üê –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ!
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ì—Ä—É–ø–ø—ã –≤ –ø–æ—Ä—è–¥–∫–µ
```
–ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:
- –õ–∏–ø–µ—Ç–æ—Ä: "–¢–µ—Å—Ç–µ—Ä", ID=1001
- –§—É–±—É–∫—Å—É—Å–∞—Ç: "–¢–µ—Å—Ç–µ—Ä", ID=1001  ‚Üê –£–∂–µ –≤ –ø–æ—Ä—è–¥–∫–µ!
- –ê—Å–ø–∏—Ä–∏–Ω: "–£—Ç—Ä–µ–Ω–Ω–∏–µ", ID=2001
- –í–∏—Ç–∞–º–∏–Ω D: "–£—Ç—Ä–µ–Ω–Ω–∏–µ", ID=2001  ‚Üê –£–∂–µ –≤ –ø–æ—Ä—è–¥–∫–µ!

–†–µ–∑—É–ª—å—Ç–∞—Ç:
- –ù–∏–∫–∞–∫–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç
```

## üéØ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**GroupFixer** - —ç—Ç–æ **—Ç–æ—á–µ—á–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç** –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –ø—Ä–æ–±–ª–µ–º—ã:
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ –≥—Ä—É–ø–ø—ã —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º –Ω–∞–∑–≤–∞–Ω–∏–µ–º, –Ω–æ —Ä–∞–∑–Ω—ã–º–∏ ID
- ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –º–µ–∂–¥—É —Ä–∞–∑–Ω—ã–º–∏ –≥—Ä—É–ø–ø–∞–º–∏
- ‚úÖ –ù–µ –∑–∞—Ç—Ä–∞–≥–∏–≤–∞–µ—Ç –ª–µ–∫–∞—Ä—Å—Ç–≤–∞ –±–µ–∑ –≥—Ä—É–ø–ø—ã
- ‚úÖ –ù–µ –∏–∑–º–µ–Ω—è–µ—Ç –Ω–∞–∑–≤–∞–Ω–∏—è –≥—Ä—É–ø–ø

**–û—Ç–≤–µ—Ç –Ω–∞ –≤–∞—à –≤–æ–ø—Ä–æ—Å:** –ù–µ—Ç, GroupFixer –ù–ï –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –ª–µ–∫–∞—Ä—Å—Ç–≤–∞ —Å —Ä–∞–∑–Ω—ã–º–∏ –Ω–∞–∑–≤–∞–Ω–∏—è–º–∏ –≥—Ä—É–ø–ø –≤ –æ–¥–Ω—É –≥—Ä—É–ø–ø—É. –ö–∞–∂–¥–∞—è –≥—Ä—É–ø–ø–∞ —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º –Ω–∞–∑–≤–∞–Ω–∏–µ–º –æ—Å—Ç–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ–π –∏ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ–π. 