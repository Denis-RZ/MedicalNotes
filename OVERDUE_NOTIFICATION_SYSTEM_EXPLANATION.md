# –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ—Å—Ä–æ—á–∫–∏ –ª–µ–∫–∞—Ä—Å—Ç–≤ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

## üéØ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–æ—Å—Ä–æ—á–∫–∏ –ª–µ–∫–∞—Ä—Å—Ç–≤

### üìã –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

#### 1. **OverdueCheckService** - –ì–ª–∞–≤–Ω—ã–π —Å–µ—Ä–≤–∏—Å
- **Foreground Service** - —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–∞–∂–µ –∫–æ–≥–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–æ
- **–ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞** –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫** –ø—Ä–∏ —É–±–∏–π—Å—Ç–≤–µ –ø—Ä–æ—Ü–µ—Å—Å–∞

#### 2. **AlarmManager** - –°–∏—Å—Ç–µ–º–Ω—ã–µ –±—É–¥–∏–ª—å–Ω–∏–∫–∏
- **–¢–æ—á–Ω—ã–µ –±—É–¥–∏–ª—å–Ω–∏–∫–∏** –¥–ª—è –≤—Ä–µ–º–µ–Ω–∏ –ø—Ä–∏–µ–º–∞ –ª–µ–∫–∞—Ä—Å—Ç–≤
- **–†–∞–±–æ—Ç–∞—é—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ** –æ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- **–ê–≤—Ç–æ–∑–∞–ø—É—Å–∫** –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞

#### 3. **BootReceiver** - –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫
- **–°–ª—É—à–∞–µ—Ç –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫—É** —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
- **–í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç** –≤—Å–µ –±—É–¥–∏–ª—å–Ω–∏–∫–∏
- **–ó–∞–ø—É—Å–∫–∞–µ—Ç —Å–µ—Ä–≤–∏—Å** –ø—Ä–æ–≤–µ—Ä–∫–∏

## üîÑ –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### –ö–æ–≥–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –û–¢–ö–†–´–¢–û:
```
1. MainActivity –∑–∞–ø—É—Å–∫–∞–µ—Ç OverdueCheckService
2. –°–µ—Ä–≤–∏—Å –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ª–µ–∫–∞—Ä—Å—Ç–≤–∞ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
3. –ü—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö –ª–µ–∫–∞—Ä—Å—Ç–≤:
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
   - –ó–∞–ø—É—Å–∫–∞–µ—Ç –∑–≤—É–∫ –∏ –≤–∏–±—Ä–∞—Ü–∏—é
   - –û–±–Ω–æ–≤–ª—è–µ—Ç UI
```

### –ö–æ–≥–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ó–ê–ö–†–´–¢–û:
```
1. OverdueCheckService –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –≤ —Ñ–æ–Ω–µ
2. AlarmManager —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤ –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è
3. MedicineAlarmReceiver –ø–æ–ª—É—á–∞–µ—Ç —Å–∏–≥–Ω–∞–ª
4. –ó–∞–ø—É—Å–∫–∞–µ—Ç OverdueCheckService
5. –°–µ—Ä–≤–∏—Å –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ –ª–µ–∫–∞—Ä—Å—Ç–≤–∞
6. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
```

## ‚è∞ –í—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ—Ä–æ–≥–∏ –ø—Ä–æ—Å—Ä–æ—á–∫–∏

### üö® –†–∞–∑–Ω—ã–µ –ø–æ—Ä–æ–≥–∏ –≤ —Ä–∞–∑–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö (–ü–†–û–ë–õ–ï–ú–ê!)

#### –í `DosageCalculator.isMedicineOverdue()`:
```kotlin
timeDiff.toHours() > 1  // 1 —á–∞—Å
```

#### –í `DosageCalculator.getMedicineStatus()`:
```kotlin
timeDiff.toMinutes() > 1  // 1 –º–∏–Ω—É—Ç–∞
```

#### –í `MedicineStatusHelper.isOverdue()`:
```kotlin
val bufferMinutes = 15L  // 15 –º–∏–Ω—É—Ç
```

**–ü–†–û–ë–õ–ï–ú–ê**: –õ–µ–∫–∞—Ä—Å—Ç–≤–æ –º–æ–∂–µ—Ç –±—ã—Ç—å "–ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–º" –ø–æ –æ–¥–Ω–æ–π –ª–æ–≥–∏–∫–µ, –Ω–æ "–∞–∫—Ç–∏–≤–Ω—ã–º" –ø–æ –¥—Ä—É–≥–æ–π!

## üîî –°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### –¢–∏–ø—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:

#### 1. **–û–±—ã—á–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** (NotificationService)
- –ü–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –≤ –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è –ø—Ä–∏–µ–º–∞
- –ó–≤—É–∫ + –≤–∏–±—Ä–∞—Ü–∏—è
- –ú–æ–∂–Ω–æ –æ—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ "–ø—Ä–∏–Ω—è—Ç–æ"

#### 2. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø—Ä–æ—Å—Ä–æ—á–∫–µ** (OverdueCheckService)
- –ü–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –¥–ª—è –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö –ª–µ–∫–∞—Ä—Å—Ç–≤
- **–ü–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è –∑–≤—É–∫ –∏ –≤–∏–±—Ä–∞—Ü–∏—è** –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
- **–í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç** - –æ–±—Ö–æ–¥—è—Ç Do Not Disturb
- **–ü–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –Ω–∞ —ç–∫—Ä–∞–Ω–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏**

### –ö–∞–Ω–∞–ª—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:

```kotlin
// –ö–∞–Ω–∞–ª –¥–ª—è —Ñ–æ–Ω–æ–≤–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
CHANNEL_ID = "overdue_check_service"
IMPORTANCE_LOW

// –ö–∞–Ω–∞–ª –¥–ª—è –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö –ª–µ–∫–∞—Ä—Å—Ç–≤
CHANNEL_ID_OVERDUE = "overdue_medicines"
IMPORTANCE_HIGH
enableVibration(true)
setBypassDnd(true)
lockscreenVisibility = VISIBILITY_PUBLIC
```

## üéµ –ó–≤—É–∫–∏ –∏ –≤–∏–±—Ä–∞—Ü–∏—è

### –ö–æ–≥–¥–∞ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è:
- **–û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ –ª–µ–∫–∞—Ä—Å—Ç–≤–∞**
- **–ü–æ–≤—Ç–æ—Ä—è—é—Ç—Å—è –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥**
- **–ù–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è** –ø–æ–∫–∞ –ª–µ–∫–∞—Ä—Å—Ç–≤–∞ –Ω–µ –ø—Ä–∏–Ω—è—Ç—ã

### –ö–∞–∫ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è:
```kotlin
// –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ "–í—ã–ø–∏–ª –ª–µ–∫–∞—Ä—Å—Ç–≤–æ"
OverdueCheckService.forceStopSoundAndVibration()

// –ü—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö –ª–µ–∫–∞—Ä—Å—Ç–≤
stopRepeatingSoundAndVibration()
restoreOriginalSettings()
```

## üîß –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏

### BootReceiver:
```kotlin
override fun onReceive(context: Context, intent: Intent) {
    when (intent.action) {
        Intent.ACTION_BOOT_COMPLETED -> {
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–µ –±—É–¥–∏–ª—å–Ω–∏–∫–∏
            // –ó–∞–ø—É—Å–∫–∞–µ–º —Å–µ—Ä–≤–∏—Å –ø—Ä–æ–≤–µ—Ä–∫–∏
        }
    }
}
```

### –í AndroidManifest.xml:
```xml
<receiver android:name=".receiver.BootReceiver">
    <intent-filter>
        <action android:name="android.intent.action.BOOT_COMPLETED" />
    </intent-filter>
</receiver>
```

## üö® –ü—Ä–æ–±–ª–µ–º—ã –≤ —Ç–µ–∫—É—â–µ–π —Å–∏—Å—Ç–µ–º–µ

### 1. **–†–∞–∑–Ω—ã–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ—Ä–æ–≥–∏**
- 1 –º–∏–Ω—É—Ç–∞ vs 1 —á–∞—Å vs 15 –º–∏–Ω—É—Ç
- –°–æ–∑–¥–∞–µ—Ç –ø—É—Ç–∞–Ω–∏—Ü—É –≤ —Å—Ç–∞—Ç—É—Å–∞—Ö

### 2. **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏**
- `DosageCalculator.isMedicineOverdue()`
- `MedicineStatusHelper.isOverdue()`
- `DosageCalculator.getMedicineStatus()`

### 3. **–°–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ "—á–µ—Ä–µ–∑ –¥–µ–Ω—å"**
- –ü—Ä–æ–≤–µ—Ä–∫–∏ `wasTakenYesterday`
- –£—Å–ª–æ–∂–Ω—è–µ—Ç –∫–æ–¥ –∏ —Å–æ–∑–¥–∞–µ—Ç –±–∞–≥–∏

### 4. **–ö–æ–Ω—Ñ–ª–∏–∫—Ç —Å—Ç–∞—Ç—É—Å–æ–≤**
- `takenToday` vs `lastTakenTime`
- –ú–æ–≥—É—Ç —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å—Å—è

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é

### 1. **–£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ—Ä–æ–≥–∏**
```kotlin
// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–µ–∑–¥–µ 15 –º–∏–Ω—É—Ç
private const val OVERDUE_BUFFER_MINUTES = 15L
```

### 2. **–û—Å—Ç–∞–≤–∏—Ç—å –æ–¥–Ω—É –ª–æ–≥–∏–∫—É –ø—Ä–æ—Å—Ä–æ—á–∫–∏**
```kotlin
// –£–±—Ä–∞—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ, –æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ MedicineStatusHelper
fun isOverdue(medicine: Medicine): Boolean
```

### 3. **–£–ø—Ä–æ—Å—Ç–∏—Ç—å –ª–æ–≥–∏–∫—É "—á–µ—Ä–µ–∑ –¥–µ–Ω—å"**
```kotlin
// –£–±—Ä–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ wasTakenYesterday
val groupDay = daysSinceStart % 2
val shouldTake = when {
    medicine.groupOrder == 1 -> groupDay == 0
    medicine.groupOrder == 2 -> groupDay == 1
    else -> false
}
```

### 4. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–¥–∏–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∫ —Å—Ç–∞—Ç—É—Å–∞–º**
```kotlin
// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ takenToday –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –¥–Ω—è
// lastTakenTime —Ç–æ–ª—å–∫–æ –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏
```

## üîç –û—Ç–ª–∞–¥–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### –õ–æ–≥–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:
```
OverdueCheckService: === –ü–†–û–í–ï–†–ö–ê –ü–†–û–°–†–û–ß–ï–ù–ù–´–• –õ–ï–ö–ê–†–°–¢–í ===
OverdueCheckService: –ù–ê–ô–î–ï–ù–û –ü–†–û–°–†–û–ß–ï–ù–ù–û–ï –õ–ï–ö–ê–†–°–¢–í–û: –õ–∏–ø–µ—Ç–æ—Ä
OverdueCheckService: –ó–ê–ü–£–°–ö–ê–ï–ú –ü–û–í–¢–û–†–Ø–Æ–©–ò–ï–°–Ø –ó–í–£–ö–ò –ò –í–ò–ë–†–ê–¶–ò–Æ
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã:
1. **–ó–∞–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ**
2. **–î–æ–∂–¥–∞—Ç—å—Å—è –≤—Ä–µ–º–µ–Ω–∏ –ø—Ä–∏–µ–º–∞ –ª–µ–∫–∞—Ä—Å—Ç–≤–∞**
3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**
4. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–≤—É–∫ –∏ –≤–∏–±—Ä–∞—Ü–∏—é**
5. **–ù–∞–∂–∞—Ç—å "–í—ã–ø–∏–ª" - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Å—Ç–∞–Ω–æ–≤–∫—É**

## üéØ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —Ä–∞–±–æ—Ç–∞–µ—Ç **–¥–∞–∂–µ –∫–æ–≥–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–æ**, –Ω–æ –∏–º–µ–µ—Ç **–ø—Ä–æ–±–ª–µ–º—ã —Å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ–º –ª–æ–≥–∏–∫–∏** –∏ **—Ä–∞–∑–Ω—ã–º–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –ø–æ—Ä–æ–≥–∞–º–∏**. 

**–û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:**
- ‚ùå –†–∞–∑–Ω—ã–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ—Ä–æ–≥–∏ (1 –º–∏–Ω vs 1 —á–∞—Å vs 15 –º–∏–Ω)
- ‚ùå –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –ø—Ä–æ—Å—Ä–æ—á–∫–∏
- ‚ùå –°–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ "—á–µ—Ä–µ–∑ –¥–µ–Ω—å"
- ‚ùå –ö–æ–Ω—Ñ–ª–∏–∫—Ç —Å—Ç–∞—Ç—É—Å–æ–≤

**–ù—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å:**
- ‚úÖ –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ—Ä–æ–≥–∏
- ‚úÖ –£–±—Ä–∞—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏
- ‚úÖ –£–ø—Ä–æ—Å—Ç–∏—Ç—å –ª–æ–≥–∏–∫—É "—á–µ—Ä–µ–∑ –¥–µ–Ω—å"
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–¥–∏–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∫ —Å—Ç–∞—Ç—É—Å–∞–º 